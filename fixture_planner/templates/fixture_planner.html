{% extends "_root.html" %}

{% block content %}
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/fixture_planner.css' %}">

<h2>
    Fixture Difficult Rating
</h2>


<p>
    FDR key: &nbsp
    <span class="diff-introduction color-1">1</span>
    <span class="diff-introduction color-2">2</span>
    <span class="diff-introduction color-3">3</span>
    <span class="diff-introduction color-4">4</span>
    <span class="diff-introduction color-5">5</span>
</p>

<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){
    $('#button').click(function(e) {
        var start_gw = $("#start_gw2").val();
        var end_gw = $("#end_gw2").val();
        var combinations = $("#combinations").val();
        if (combinations == "FDR") {
            window.location.replace(window.location.hostname + "/fixture-planner/" + start_gw + "/" + end_gw + "/" + combinations);
        }
        if (combinations == "FDR-best") {
            var min_num_fixtures = $("#min_num_fixtures").val();
            window.location.replace(window.location.hostname + "/fixture-planner/" + start_gw + "/" + end_gw + "/" + combinations + "/" + min_num_fixtures);
        }
        if (combinations == "Rotation") {
            var teams_to_play =  $("#teams_to_play").val();
            var teams_to_check =  $("#teams_to_check").val();
            window.location.replace(window.location.hostname + "/fixture-planner/" + start_gw + "/" + end_gw + "/" + combinations + "/" + teams_to_play + "/" + teams_to_check);
        }
    });
});</script>
    <script>
function myFunction(argument) {
        var start_gw = $("#start_gw2").val();
        var end_gw = $("#end_gw2").val();
        window.location.replace("/fixture-planner/" + start_gw + "/" + end_gw + "/" + argument);
}
</script>

<script>
function hide() {
  var x = document.getElementById("which_teams_to_check");
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}
</script>


<form class="text-center" action="/fixture-planner/" method="post">
    {% if combinations == "FDR" %}
    <input type="submit" class="category chosen-category" value="FDR" checked name="combination">
    {% else %}
    <input type="submit" class="category" value="FDR" name="combination">
    {% endif %}

    {% if combinations == "FDR-best" %}
    <input type="submit" class="category chosen-category" value="FDR-best" name="combination">
    {% else %}
    <input type="submit" class="category" value="FDR-best" name="combination">
    {% endif %}

    {% if combinations == "Rotation" %}
    <input type="submit" class="category chosen-category" value="Rotation" checked name="combination">
    {% else %}
    <input type="submit" class="category" value="Rotation" name="combination">
    {% endif %}
            {% csrf_token %}
    <input hidden class="box" type="number" min=1 max=38 value={{gw_start}} id="start_gw3" name="gw-info">
    <input hidden class="box" type="number" min=1 max=38 value={{gw_end}} id="end_gw3" name="gw-info">
    <input hidden type="text" value={{combinations}} id="combination2" name="combination">
    <input hidden class="box" type="number" min=1 max={{gws}} value={{min_num_fixtures}} id="min_num_fixtures2" name="min_num_fixtures">
    <input hidden type="number" min=1 max=5 value={{teams_to_check}} name="teams_to_check">
    <input hidden type="number" min=1 max=5 value={{teams_to_play}} name="teams_to_play">
    {% for team_name in team_name_list %}
             {% if forloop.counter|divisibleby:3 %}
                {% endif %}
                <input hidden type="checkbox" id="{{team_name.team_name}}-2" value="{{team_name.team_name}}" name="fpl-teams" checked>

            {% endfor %}
</form>



<div class="text-center">
    <form action="/fixture-planner/" method="post">
        GW start: &nbsp<input class="box" type="number" min=1 max=38 value={{gw_start}} id="start_gw2" name="gw-info">
        GW end: &nbsp<input class="box" type="number" min=1 max=38 value={{gw_end}} id="end_gw2" name="gw-info">

        {% if combinations == "FDR-best" %}
        <br>
        Minimum fixtures: &nbsp<input class="box" type="number" min=1 max={{gws}} value={{min_num_fixtures}} id="min_num_fixtures" name="min_num_fixtures">
        {% else %}
        <input hidden class="box" type="number" min=1 max=38 value={{min_num_fixtures}} name="min_num_fixtures">
        {% endif %}

        {% if combinations == "Rotation" %}
        <br>
        Teams to check: &nbsp<input class="box" type="number" min=1 max=5 value={{teams_to_check}} id="teams_to_check" name="teams_to_check">
        Teams to play: &nbsp<input class="box" type="number" min=1 max=5 value={{teams_to_play}} id="teams_to_play" name="teams_to_play">
        {% else %}
        <input hidden type="number" min=1 max=5 value={{teams_to_check}} name="teams_to_check">
        <input hidden type="number" min=1 max=5 value={{teams_to_play}} name="teams_to_play">
        {% endif %}

        <input hidden type="text" value={{combinations}} id="combination" name="combination">

        {% csrf_token %}
        <input class="update" type="submit" value="Search">
        <div id="which_teams_to_check">
            <div>
            {% for team_name in team_name_list %}
             {% if forloop.counter|divisibleby:3 %}
                </div>
                <div>
                {% endif %}
                <input type="checkbox" id="{{team_name.team_name}}" value="{{team_name.team_name}}" name="fpl-teams" {{team_name.checked}}>
                    {% if combinations == "Rotation" %}
                        <input class="solution-box" type="checkbox" id="{{team_name.team_name}}-in-solution" value="{{team_name.team_name}}" name="fpl-teams-in-solution" {{team_name.checked_must_be_in_solution}}>
                     {% endif %}
                <label for="{{team_name.team_name}}">{{team_name.team_name}}</label>
            {% endfor %}
                </div>
        </div>
    </form>
    <button class="margin-top-bottom" onclick="hide()">Include teams in solution &#x2193</button>
</div>


<div id="spinner-box" class="text-center mt-3">
    <div class="spinner-border text-primary" role="status"></div>
</div>

<div id="data-box" class="text-center mt-3"></div>

<script>
    console.log("Hello world")
    const spinnerBox = document.getElementById('spinner-box')
    const dataBox = document.getElementById('data-box')
    $.ajax({
        type: 'GET',
        url: '/',
        success: function(res){
            spinnerBox.classList.add('not-visible')
            dataBox.innerHTML += `
            {% if combinations == "FDR" or combinations == "FDR-best" %}
                <div class="container-fdr">
                    <div id="fdr-table" class="container-rotation">
                        <div id="fdr-team-names">
                            <table>
                                <tbody>
                                    <tr>
                                        <td class="name-column min-width">
                                            Name
                                        </td>
                                    </tr>
                                    {% for team_fixture_info in fdr_fixture_data %}
                                        {% for team in team_fixture_info %}
                                            {% if forloop.counter == 1 %}
                                                <tr>
                                                    <td class="name-column min-width">
                                                        {{ team.0.0.team_name }}
                                                    </td>
                                                </tr>
                                              {% endif %}
                                        {% endfor %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <div id="fdr-team-difficulty">
                            <table>
                                <tbody>
                                    <tr>
                                        {% for gw_number in gw_numbers %}
                                        <th class="min-width"> GW {{ gw_number.gameweek }}
                                            <div class="day_month">
                                                {{ gw_number.day_month }}
                                            </div>
                                        </th>
                                        {% endfor %}
                                    </tr>

                                    {% for team_fixture_info in fdr_fixture_data %}
                                        <tr>
                                            {% for teams in team_fixture_info %}
                                                {% if teams|length == 1 %}
                                                    <td scope="col" class=" min-width color-{{teams.0.0.difficulty_score}} double-border-{{teams.0.0.Use_Not_Use}}">
                                                {% else %}
                                                    <td scope="col" class=" min-width no-padding double-border-{{teams.0.0.Use_Not_Use}}">
                                                {% endif %}

                                                {% for team in teams %}
                                                        <div class=" min-width color-{{team.0.difficulty_score}} multiple-fixtures height-{{ teams|length }}">
                                                    {% if team.0.opponent_team_name == '-' %}
                                                        Blank
                                                    {% else %}
                                                        {{  team.0.opponent_team_name }}&nbsp({{  team.0.H_A  }})
                                                    {% endif %}
                                                        </div>
                                                {% endfor %}
                                                </td>
                                            {% endfor %}
                                        </tr>
                                     {% endfor %}
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
                {% endif %}


                {% if combinations == "Rotation" %}
                    {% if rotation_data.0.0 != "Wrong input" %}
                        <div class="big-container">
                            <div class="container-rotation">
                                <div>
                                    <div>
                                {% for data in rotation_data %}
                                    <table class="rotation">
                                        {% if forloop.counter != 1 %}
                                        {% endif %}
                                        <tbody>
                                            <tr>
                                                <th class="name-col-rotation"> Name </th>
                                                {% for gw_number in gw_numbers %}
                                                    <th class="min-width"> GW {{ gw_number.gameweek }}
                                                    </th>
                                                {% endfor %}
                                            </tr>

                                            {% for FDR_team in data.5 %}
                                            <tr>
                                                {% for teams in FDR_team %}
                                                    {% if forloop.counter == 1 %}
                                                        <td class="name-column min-width">
                                                            {{ teams.0.team_name }}
                                                        </td>
                                                    {% endif %}
                                                    {% if teams|length == 1 %}
                                                        <td scope="col" class=" min-width color-{{teams.0.difficulty_score}} double-border-{{teams.0.Use_Not_Use}}">
                                                    {% else %}
                                                        <td scope="col" class=" min-width no-padding double-border-{{teams.0.Use_Not_Use}}">
                                                    {% endif %}

                                                    {% for team in teams %}
                                                        <div class=" min-width color-{{team.difficulty_score}} multiple-fixtures height-{{ teams|length }}">
                                                        {% if team.opponent_team_name == '-' %}
                                                            Blank
                                                        {% else %}
                                                            {{  team.opponent_team_name }}&nbsp({{  team.H_A }})
                                                        {% endif %}
                                                        </div>
                                                    {% endfor %}
                                                    </td>
                                                {% endfor %}
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                    <p>
                                        Avg. FDR score: <b>{{ data.0|floatformat:2 }}</b>
                                    </p>
                                {% endfor %}
                            </div>
                        </div>

                        </div>
                        {% else %}
                        <div style="text-align: center; font-weight: 800;">
                            <br>
                            Wrong Input
                        </div>
                    {% endif %}
                {% endif %}
                 `
        },
        error: function(error){
            spinnerBox.classList.add('not-visible')
            console.log(error)
            dataBox.innerHTML += `<b>Error loading data</b><br><br>`
        }
    })
</script>

<!--
{% if combinations == "FDR" or combinations == "FDR-best" %}
<div class="container-fdr">
    <div id="fdr-table" class="container-rotation">
        <div id="fdr-team-names">
            <table>
                <tbody>
                    <tr>
                        <td class="name-column min-width">
                            Name
                        </td>
                    </tr>
                    {% for team_fixture_info in fdr_fixture_data %}
                     {% for team in team_fixture_info %}
                         {% if forloop.counter == 1 %}
                    <tr>
                        <td class="name-column min-width">
                            {{ team.0.0.team_name }}
                        </td>
                    </tr>
                     {% endif %}
                    {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div id="fdr-team-difficulty">
            <table>
                <tbody>
                    <tr>
                        {% for gw_number in gw_numbers %}
                        <th class="min-width"> GW {{ gw_number.gameweek }}
                            <div class="day_month">
                                {{ gw_number.day_month }}
                            </div>
                        </th>
                        {% endfor %}
                    </tr>
                    {% for team_fixture_info in fdr_fixture_data %}
                     <tr>
                          {% for teams in team_fixture_info %}
                          {% if teams|length == 1 %}
                          <script>
                          document.write("<td scope='col' class=' min-width color-{{teams.0.0.difficulty_score}} double-border-{{teams.0.0.Use_Not_Use}}'>");
                          </script>
                          {% else %}
                           <script>
                         document.write("<td scope='col' class=' min-width no-padding double-border-{{teams.0.0.Use_Not_Use}}'>");
                           </script>
                          {% endif %}
                          {% for team in teams %}
                        <script>
                            document.write("<div class=' min-width color-{{team.0.difficulty_score}} multiple-fixtures height-{{ teams|length }}'>");
                        </script>
                          {% if team.0.opponent_team_name == '-' %}
                            Blank
                          {% else %}
                            {{  team.0.opponent_team_name }}&nbsp({{  team.0.H_A  }})
                          {% endif %}
                          </div>
                        {% endfor %}
                          </td>
                      {% endfor %}
                     </tr>
                 {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %} -->



<!-- {% if combinations == "Rotation" %}
{% if rotation_data.0.0 != "Wrong input" %}
<div class="big-container">
    <div class="container-rotation">
        <div>
            <div>
            {% for data in rotation_data %}
                <table class="rotation">
                    {% if forloop.counter != 1 %}
                    {% endif %}

                    <tbody>
                            <tr>
                                <th class="name-col-rotation"> Name </th>
                                {% for gw_number in gw_numbers %}
                                    <th class="min-width"> GW {{ gw_number.gameweek }}
                                    </th>
                                {% endfor %}
                            </tr>
                            {% for FDR_team in data.5 %}
                                     <tr>
                                     {% for teams in FDR_team %}
                                            {% if forloop.counter == 1 %}
                                                    <td class="name-column min-width">
                                                    {{ teams.0.team_name }}
                                                    </td>
                                            {% endif %}


                                         {% if teams|length == 1 %}
                                      <script>
                                      document.write("<td scope='col' class=' min-width color-{{teams.0.difficulty_score}} double-border-{{teams.0.Use_Not_Use}}'>");
                                      </script>
                                      {% else %}
                                       <script>
                                     document.write("<td scope='col' class=' min-width no-padding double-border-{{teams.0.Use_Not_Use}}'>");
                                       </script>
                                      {% endif %}

                                         {% for team in teams %}
                                    <script>
                                        document.write("<div class=' min-width color-{{team.difficulty_score}} multiple-fixtures height-{{ teams|length }}'>");
                                    </script>
                                      {% if team.opponent_team_name == '-' %}
                                        Blank
                                      {% else %}
                                        {{  team.opponent_team_name }}&nbsp({{  team.H_A }})
                                      {% endif %}
                                      </div>
                                        {% endfor %}

                                      </td>
                                  {% endfor %}
                                 </tr>
                            {% endfor %}


                    </tbody>
                </table>
                <p>
                    Avg. FDR score: <b>{{ data.0|floatformat:2 }}</b>
                </p>
                {% endfor %}
            </div>
        </div>
    </div>
     {% else %}
        <div style="text-align: center; font-weight: 800;">
            <br>
            Wrong Input
        </div>
            {% endif %}
{% endif %} -->

{% endblock content %}




